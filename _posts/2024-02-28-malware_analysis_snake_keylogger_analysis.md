---
title:  "Malware Analysis - Snake keylogger analysis"
date:   2024-02-28 14:04:00 +0300
author: cozy
categories: [malware, stealer, keylogger]
---

### Introduction

First of all this sample was written in a .NET-C# language.
SHA256: `c3a293e618862269f76436ad1a144fe2113b0f5207c4cb3c45048ba198574a03`
MalwareBazaar link: https://bazaar.abuse.ch/sample/c3a293e618862269f76436ad1a144fe2113b0f5207c4cb3c45048ba198574a03/

### Unpacking

#### Stage 1

File was written in .NET, so it can easily be decompiled. I use dnSpy-net-win32.
![](/images/snake/1.png)


Obfuscated with some shitty obfuscator (idk what that obfuscator is, but idgaf)
![](/images/snake/2.png)


just use de4dot. 
Use: `de4dot.exe c3a293e618862269f76436ad1a144fe2113b0f5207c4cb3c45048ba198574a03.exe`
This stage decrypts MZ .NET executable via AES 
![](/images/snake/3.png)

![](/images/snake/4.png)


It decrypts resource with name '*Example*' 
![](/images/snake/5.png)


We can set breakpoint here and see byte_0 array.
![](/images/snake/6.png)\
After execution we can see 0x4d 0x5a bytes, that bytes is 'MZ' signature so just dump that array to file
![](/images/snake/7.png)

#### Stage 2
dumped file also .NET executable but now it is DLL.
![](/images/snake/8.png)\
Load it to dnSpy.
![](/images/snake/9.png)\
I stuck here because this binary do some calculation but icant debug it, so i try to change *File header->Characteristics* and uncheck checkbox *File is a DLL*
![](/images/snake/10.png)\
But that dont work ;)
Then I checked calculation inside that dll and they were easy ^-^;
Inside Main there 4 methods, we need to check last method
![](/images/snake/11.png)\
Inside that method it call some shit
Also there is injection into ***RegAsm.exe*** process.
![](/images/snake/12.png)\
![](/images/snake/13.png)\
Also there is method *Madhu*
![](/images/snake/14.png)\
But broo) i dont want to check that shit.
![](/images/snake/15.png)

We need to check method *Lyubochka* (хахахаха бля любочка нет бля хуюбочка)
![](/images/snake/16.png)

![](/images/snake/17.png)\
some simple calculations like AES decryption where key is sha256 hash of string in ECB mode, iv is empty.

я типа не силен в c# поэтому просто в c# online compiler ебашу код чтоб узнать хеш то есть ключ для AES.

Simple C# script
```csharp
using System;
using System.Security.Cryptography;
using System.Text;
class Hyi {
  static void Main() {
    SHA256CryptoServiceProvider sha256CryptoServiceProvider = new SHA256CryptoServiceProvider();
    string GkUvCwJGAJAwyvAGDLnJr = "dkNoosQSwp";
	byte[] key = sha256CryptoServiceProvider.ComputeHash(Encoding.BigEndianUnicode.GetBytes(GkUvCwJGAJAwyvAGDLnJr));
    Console.WriteLine(BitConverter.ToString(key));
  }
}
```

Also for another call of this method just replace `GkUvCwJGAJAwyvAGDLnJr` variable with that value.
![](/images/snake/18.png)

It decodes 2 resources: *AQipUvwTwkLZyiCs* and *Scrivens*. So dump them.
Use cyberchef to decode it.
![](/images/snake/19.png)\
And we have another exe file.
Do it for both resources)

#### Stage 3


![](/images/snake/20.png)\
First file res1.bin(AQipUvwTwkLZyiCs) just load api hahah fuck it
![](/images/snake/21.png)

Second file res2.bin is exe .NET obfuscated, so just use de4dot.
bunch of methods
![](/images/snake/22.png)\
Some c2
![](/images/snake/23.png)\
`http://varders[.]kozow[.]com:8081`
`http://aborters[.]duckdns[.]org:8081`
`http://anotherarmy[.]dns[.]army:8081`

It try to download some shit from thats c2, but they are down.
![](/images/snake/24.png)\
It try to download by concat c2 + "/_send_.php?TS".

Also there is some methods that kill browsers to get some personal information like passwords, autofill data and etc.
![](/images/snake/25.png)\
![](/images/snake/26.png)\
In one of methods it gets passwords of IMAP, POP3, HTTP, SMTP from outlook app and add it to list 
![](/images/snake/27.png)\
![](/images/snake/28.png)\
Then it concat it to that format string
![](/images/snake/29.png)\
Also for FOXmail
![](/images/snake/30.png)

i thought just do some table of спизженные сервисы

#### Stolen data
бля я конкретно заебался делать эту хуйню просто пиздец. вот неужели надо ноунейм браузеры пиздить, просто в след раз пиздите только файрфокс, аутлук и хром все бля.

сначала скрин что он пиздит комплексно
![](/images/snake/31.png)

а теперь ебанутая таблица 


|       App name       |                                                            Stolen from                                                            |  Stolen  |     |     |     |     |
| :------------------: | :-------------------------------------------------------------------------------------------------------------------------------: | :------: | --- | --- | --- | --- |
|       Outlook        |                  Software\\Microsoft\\Office\\15.0\\Outlook\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676                  |   URL    |     |     |     |     |
|                      | Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows Messaging Subsystem\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676 |  E-Mail  |     |     |     |     |
|                      |                   Software\\Microsoft\\Windows Messaging Subsystem\\Profiles\\9375CFF0413111d3B88A00104B2A6676                    |   PSWD   |     |     |     |     |
|                      |                  Software\\Microsoft\\Office\\16.0\\Outlook\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676                  |          |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Foxmail        |                SOFTWARE\\Classes\\Foxmail.url.mailto\\Shell\\open\\command ? Storage\\ ? \\Accounts\\Account.rec0                 |  E-Mail  |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Amigo         |                                         %LOCALAPPDATA%\Amigo\User Data\Default\Login Data                                         |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|         Xpom         |                                         %LOCALAPPDATA%\Xpom\User Data\Default\Login Data                                          |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Kometa        |                                        %LOCALAPPDATA%\Kometa\User Data\Default\Login Data                                         |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Nichrome       |                                       %LOCALAPPDATA%\Nichrome\User Data\Default\Login Data                                        |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Google        |                                     %LOCALAPPDATA%\Google\Chrome\User Data\Default\Login Data                                     |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        CocCoc        |                                    %LOCALAPPDATA%\CocCoc\Browser\User Data\Default\Login Data                                     |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Tencent        |                                   %LOCALAPPDATA%\Tencent\QQBrowser\User Data\Default\Login Data                                   |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Orbitum        |                                        %LOCALAPPDATA%\Orbitum\User Data\Default\Login Data                                        |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Slimjet        |                                        %LOCALAPPDATA%\Slimjet\User Data\Default\Login Data                                        |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Iridium        |                                        %LOCALAPPDATA%\Iridium\User Data\Default\Login Data                                        |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Vivaldi        |                                        %LOCALAPPDATA%\Vivaldi\User Data\Default\Login Data                                        |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Chromium       |                                       %LOCALAPPDATA%\Chromium\User Data\Default\Login Data                                        |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|     GhostBrowser     |                                     %LOCALAPPDATA%\GhostBrowser\User Data\Default\Login Data                                      |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|     CentBrowser      |                                      %LOCALAPPDATA%\CentBrowser\User Data\Default\Login Data                                      |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Xvast         |                                              \\Xvast\\User Data\\Default\\Login Data                                              |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Chedot        |                                             \\Chedot\\User Data\\Default\\Login Data                                              |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|      SuperBird       |                                            \\SuperBird\\User Data\\Default\\Login Data                                            |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|      360Browser      |                                       \\360Browser\\Browser\\User Data\\Default\\Login Data                                       |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|      360Chrome       |                                        \\360Chrome\\Chrome\\User Data\\Default\\Login Data                                        |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Comodo        |                                         \\Comodo\\Dragon\\User Data\\Default\\Login Data                                          |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PWSD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|    BraveSoftware     |                                  \\BraveSoftware\\Brave-Browser\\User Data\\Default\\Login Data                                   |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Torch         |                                              \\Torch\\User Data\\Default\\Login Data                                              |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|      UCBrowser       |                                      \\UCBrowser\\User Data_i18n\\Default\\UC Login Data.18                                       |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Blisk         |                                              \\Blisk\\User Data\\Default\\Login Data                                              |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
| Epic Privacy Browser |                                      \\Epic Privacy Browser\\User Data\\Default\\Login Data                                       |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|    Opera Software    |                            \\Opera Software\\Opera Stable\\Login Data\\Opera\\Opera\\profile\\wand.dat                            |   Host   |     |     |     |     |
|                      |                                                                                                                                   |   USR    |     |     |     |     |
|                      |                                                                                                                                   |   PSWD   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|      FileZilla       |                                              %APPDATA%\\FileZilla\\recentservers.xml                                              |   Host   |     |     |     |     |
|                      |                                                                                                                                   | Username |     |     |     |     |
|                      |                                                                                                                                   | Password |     |     |     |     |
|                      |                                                                                                                                   |   Port   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Pidgin        |                                                 %APPDATA%\\.purple\\accounts.xml                                                  | Protocol |     |     |     |     |
|                      |                                                                                                                                   |   Name   |     |     |     |     |
|                      |                                                                                                                                   | Password |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Liebao        |                                      %local%\\Liebao7\\User Data\\Default\\EncryptedStorage                                       |   Host   |     |     |     |     |
|                      |                                                                                                                                   | Username |     |     |     |     |
|                      |                                                                                                                                   | Password |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Avast         |                                     \\AVAST Software\\Browser\\User Data\\Default\\Login Data                                     |   Host   |     |     |     |     |
|                      |                                                                                                                                   | Username |     |     |     |     |
|                      |                                                                                                                                   | Password |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Kinza         |                                              \\Kinza\\User Data\\Default\\Login Data                                              |   Host   |     |     |     |     |
|                      |                                                                                                                                   | username |     |     |     |     |
|                      |                                                                                                                                   | password |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|      BlackHawk       |                                            \\BlackHawk\\User Data\\Default\\Login Data                                            |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Citrio        |                                      \\CatalinaGroup\\Citrio\\User Data\\Default\\Login Data                                      |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|         Uran         |                                         \\uCozMedia\\Uran\\User Data\\Default\\Login Data                                         |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Coowon        |                                         \\Coowon\\Coowon\\User Data\\Default\\Login Data                                          |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        7Star         |                                          \\7Star\\7Star\\User Data\\Default\\Login Data                                           |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       QIP Surf       |                                            \\QIP Surf\\User Data\\Default\\Login Data                                             |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Sleipnir       |                      %APPDATA%\\Fenrir Inc\\Sleipnir5\\setting\\modules\\ChromiumViewer\\Default\\Login Data                      |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|    Chrome Canary     |                                       \\Google\\Chrome SxS\\User Data\\Default\\Login Data                                        |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       CoolNovo       |                                     \\MapleStudio\\ChromePlus\\User Data\\Default\\Login Data                                     |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Sputnik        |                                        \\Sputnik\\Sputnik\\User Data\\Default\\Login Data                                         |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|        Falcon        |                                        \\Sputnik\\Sputnik\\User Data\\Default\\Login Data                                         |   host   |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|    Edge Chromium     |                                         \\Microsoft\\Edge\\User Data\\Default\\Login Data                                         |   hst    |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|       Discord        |                                             \\discord\\Local Storage\\leveldb\\*.log                                              |  token   |     |     |     |     |
|                      |                                                                                                                                   |          |     |     |     |     |
|         Slim         |                                           FlashPeak\\SlimBrowser\\Profiles\\logins.json                                           |   hst    |     |     |     |     |
|                      |                                                                                                                                   |   usr    |     |     |     |     |
|                      |                                                                                                                                   |   pswd   |     |     |     |     |




Also stealer checks if client ip is equal one of them, stealer add strings "BotDetected"
![](/images/snake/32.png)\
![](/images/snake/33.png)

Эта залупа отправляет mailMessage на адрес `county@valleycountysar.org`
![](/images/snake/34.png)\
где string16 это фулл инфа 
![](/images/snake/35.png)\
Также ебашит SMTP Client `valleycountysar.org` на 25 порт с такими кредами:
*county@valleycountysar[.]org:iU0Ta!$K8L51*

Скрипт чтоб подекодить эту хуйню
```csharp
using System;
using System.Security.Cryptography;
using System.Text;
class Zalupa {
  static void Main() {
    Console.WriteLine(smethod_15("+DQQWtID78+kn3fU9Z4BFQ==", "BsrOkyiChvpfhAkipZAxnnChkMGkLnAiZhGMyrnJfULiDGkfTkrTELinhfkLkJrkDExMvkEUCxUkUGr"));
  }
  public static string smethod_15(string string_32, string string_33)
    {
	string result;
		DESCryptoServiceProvider descryptoServiceProvider = new DESCryptoServiceProvider();
		MD5CryptoServiceProvider md5CryptoServiceProvider = new MD5CryptoServiceProvider();
		byte[] array = new byte[8];
		byte[] sourceArray = md5CryptoServiceProvider.ComputeHash(Encoding.ASCII.GetBytes(string_33));
		Array.Copy(sourceArray, 0, array, 0, 8);
		descryptoServiceProvider.Key = array;
		descryptoServiceProvider.Mode = CipherMode.ECB;
		ICryptoTransform cryptoTransform = descryptoServiceProvider.CreateDecryptor();
		byte[] array2 = Convert.FromBase64String(string_32);
		string hyi = Encoding.ASCII.GetString(cryptoTransform.TransformFinalBlock(array2, 0, array2.Length));
		result = hyi;
	return result;
    }
}
```

Также пиздит клипборд, ебашит скрины экрана сохраняет их в My Documents\SnakeKeylogger\Screenshoot.png
Еще умеет в кейлоггинг, пиздить тг сессию и еще всякая залупень которая почему то не вызывается.

#### Conclusion

good stealer, gooood. fuck them with amount of browsers;;
